<h1>Battle</h1>
<div id="chatWrap" style="height: 500px; overflow-y: scroll; overflow-x: auto; border:2px solid;">
	<ul id="chat">
		<%= render @messages %>
		<li><i>Previous messages</i></li>
	</ul>
</div>
<hr />

<%= form_for Message.new, remote: true do |f| %>
	<input id="message_sender" name="message[sender]" value="testi_sender" type="hidden" />
	<input id="message_room_number" name="message[room_number]" value="<%= render text: params[:id] %>" type="hidden" />
	<%= f.text_field :content %>
	<%= f.submit "Send" %>
<% end %>

<%= link_to "Back to lobby", rooms_path %>

<%#= subscribe_to "/channels/#{params[:id]}" %>

<script type="text/javascript">
	channel = document.URL.split('/').slice(-1)[0];
	faye = new Faye.Client('http://localhost:9292/faye');
	faye.subscribe("/channels/"+channel, function (data) {
		$("#chat").append('<li>' + data.object.content + '</li>');
	});

	window.setInterval(function() {
		var elem = document.getElementById('chatWrap');
		elem.scrollTop = elem.scrollHeight;
	}, 1000);
</script>